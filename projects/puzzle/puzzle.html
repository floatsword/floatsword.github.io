<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>拼图小游戏~</title>
    <link rel="stylesheet" href="styles/main.css">
</head>
<body >

    <div class="btn-group">
        <input type="file" id="input-file" style="display:none">
        <button class="btn" id="addPic" type="button">添加图片</button>
        <button class="btn" id="splitPic" type="button">绘制拼图</button>
        <button class="btn" id="sortPic" type="button">打乱顺序</button>
        <button class="btn" id="lv-up" type="button">提升难度</button>
        <button class="btn" id="lv-down" type="button">降低难度</button>
        <button class="btn" id="view" type="button">查看原图</button>
    </div>

    <!-- 默认列表 -->
    <ul id="picList" class="pic-list">
        <p>将图片拖入左侧</p>
        <li class="pic-item">
            <img src="images/pic01.jpg">
        </li>
        <li class="pic-item"><img src="images/pic02.jpg"></li>
        <li class="pic-item"><img src="images/pic03.jpg"></li>
        <li class="pic-item"><img src="images/pic04.jpg"></li>
    </ul>



    <!-- gamebox -->
    <ul id="game-box" class="puzzle-list">
    </ul>

    <!-- 遮罩层 -->

    <canvas id="canvas" width="700" height="600" style="border:10px solid #abc;margin:0 auto;display:none"></canvas>

    <script src="canvas.js"></script>

    <script>
        var inputFile = document.getElementById("input-file")
        var addPic = document.getElementById("addPic");
        var splitPic = document.getElementById("splitPic");
        var sortPic = document.getElementById("sortPic");
        var lvUp = document.getElementById("lv-up")
        var lvDown = document.getElementById("lv-down")
        var view = document.getElementById("view")

        on("click", view, function(){
            if (puzzle) {
                if(!this.tips){
                    var img = new Image();
                    var body = document.body || document.documentElement;
                    img.src = puzzle.img.src;
                    img.id = "srcImg"
                    img.onload = function() {
                        img.style.display = "block";
                        body.appendChild(img);
                    }
                    this.innerHTML = "关闭提示";
                    this.tips = true;
                } else {
                    this.innerHTML = "查看原图";
                    var img = document.getElementById("srcImg");
                    img.parentNode.removeChild(img);
                    this.tips = false;
                }


            }
        })
        on("click", lvUp, function() {
            if (puzzle&&puzzle.count<5) {
                puzzle.count++
                puzzle.init()
            } else if (puzzle) {
                puzzle.count = 5;
                alert("太厉害了！！您已经是大神级别了！")
            }
        })
        on("click", lvDown, function() {
            if (puzzle&&puzzle.count>3) {
                puzzle.count--
                puzzle.init()
            } else if (puzzle) {
                puzzle.count = 3;
                alert("加油哦，一定可以完成的")
            }
        })

        on("click",addPic, function() {
            inputFile.click()
        })

        on("click", sortPic, function(){
            if (puzzle) {
                puzzle.sort();
            }
        })

        on("click", splitPic, function(){
            if (puzzle){
                puzzle.split()
            }
        })

        on("change", inputFile,handleFile)

        var puzzle = null;

        //从input获得图片信息
        function handleFile() {
            var img = new Image();
            var reader = new FileReader();
            var body = document.body || document.documentElement;
            reader.readAsDataURL(this.files[0])
            reader.onload = function(e){
                img.src = e.target.result;
                puzzle = new Puzzle(img);
                puzzle.init(body)
            }
        }

        //拖拽处理图像
        var picList = document.getElementById("picList")
        on("dragenter",picList, function(event){
            var ev = event || window.event;
            ev.preventDefault()
        })
        on("dragover",picList, function(event){
            var ev = event || window.event;
            ev.preventDefault()
        })
        on("dragstart",picList, function(event){
            var ev = event || window.event;
            var tar = ev.target || ev.srcElement;
            ev.dataTransfer.setData("src",tar.src);
        })

    </script>
</body>
</html>
